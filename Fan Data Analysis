import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import os

#instantiates folder to access files and filenames
directory = 'data'

expcfms = []
exppressures = []

fansanddata = {}

#iterates through files in the folder
for filename in os.listdir(directory):
  #reads file and calculates average cfm, static pressure, and extracts the fan model number
  p = pd.read_csv(os.path.join(directory,filename),delimiter='\t')
  modelnum = filename.split()[0]
  maxcfm=0
  maxstp=0
  if modelnum not in fansanddata.keys(): fansanddata[modelnum] = list()

  #prints the max cfm and and max static pressuer of the fans
  if 'Fully Open' in filename:
    maxcfm = np.mean(p.CFM)
    print('Max CFM for the fan {} is {}'.format(modelnum,maxcfm))
    expcfms.append(maxcfm)
    fansanddata[modelnum].append(maxcfm)
  elif 'Fully Closed' in filename:
    maxstp = np.mean(p['Static Pressure (inches of water)'])
    print('Max Static Pressure for the fan {} is {}(in of water)'.format(modelnum,maxstp))
    exppressures.append(maxstp)
    fansanddata[modelnum].append(maxstp)

theocfms = [24,118, 81.5, 90, 42.7, 99, 77.7]
theopressures= [.32,1.12,.35,.4,.9,.49,.42]
print(expcfms)
print(exppressures)
print(fansanddata)

pctdifcfm = []
for i in range(len(expcfms)):
  pctdifcfm.append(100*abs(expcfms[i]-theocfms[i])/expcfms[i])


plt.figure(figsize=(16,9))
plt.bar(range(len(theocfms)),pctdifcfm)
plt.xticks(range(len(theocfms)),fansanddata.keys(),fontsize=5)
plt.title('Percent Differential of Theoretical and Experimental Fan CFMs')

pctdifpres = []
for i in range(len(exppressures)):
  pctdifpres.append(100*abs(exppressures[i]-theopressures[i])/exppressures[i])


plt.figure(figsize=(16,9))
plt.bar(range(len(theopressures)-1),pctdifpres)
plt.xticks(range(len(theocfms)),fansanddata.keys(),fontsize=5)
plt.title('Percent Differential of Theoretical and Experimental Static Pressures')


print(expcfms)
print(theocfms)

